<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"><title>Login to Guahh</title>
    <link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter+Tight:wght@400;600&display=swap" rel="stylesheet">
    <style>body{font-family:'Inter Tight',sans-serif;background-color:#f4f4f5;display:flex;justify-content:center;align-items:center;min-height:100vh;margin:0;padding:2rem 0}.container{background-color:#fff;padding:2.5rem;border-radius:8px;box-shadow:0 4px 12px #0000001a;width:100%;max-width:420px}h1{text-align:center;color:#18181b;margin-top:0}.form-group{margin-bottom:1.5rem}label{display:block;margin-bottom:.5rem;color:#52525b;font-weight:600}input{width:100%;padding:.75rem;border:1px solid #d4d4d8;border-radius:4px;box-sizing:border-box;font-family:'Inter Tight',sans-serif}button{width:100%;padding:.85rem;border:none;background-color:#18181b;color:#fff;border-radius:4px;cursor:pointer;font-size:1rem;font-weight:600}button:disabled{background-color:#a1a1aa}button:hover:not(:disabled){background-color:#27272a}.message{text-align:center;margin-top:1rem;padding:.75rem;border-radius:4px;display:none;font-size:.9rem;color:#b91c1c;background-color:#fee2e2}</style>
</head>
<body>
    <div class="container">
        <h1>Login to Guahh</h1>
        <form id="login-form">
            <div class="form-group"><label for="username">Username</label><input type="text" id="username" required></div>
            <div class="form-group"><label for="password">Password</label><input type="password" id="password" required></div>
            <button type="submit">Login</button>
        </form>
        <p id="error-message" class="message"></p>
    </div>
    <script>
        const loginForm = document.getElementById('login-form');
        const errorMessage = document.getElementById('error-message');

        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const btn = e.target.querySelector("button");
            btn.disabled = true;
            btn.textContent = "Logging in...";
            errorMessage.style.display = 'none';

            // Send the credentials to the parent window that opened this popup.
            // The guahh-auth.js library will handle the rest.
            window.opener.postMessage({
                type: 'GUAHH_PERFORM_LOGIN',
                credentials: {
                    username: document.getElementById('username').value,
                    password: document.getElementById('password').value
                }
            }, '*');
        });
        
        // Listen for failure messages from the parent window.
        window.addEventListener('message', (event) => {
            if (event.data && event.data.type === 'GUAHH_LOGIN_FAILED') {
                errorMessage.textContent = event.data.message;
                errorMessage.style.display = 'block';
                const btn = loginForm.querySelector("button");
                btn.disabled = false;
                btn.textContent = "Login";
            }
        });
    </script>
</body>
</html>
