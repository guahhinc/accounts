<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"><title>Guahh Account</title>
    <link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter+Tight:wght@400;600&display=swap" rel="stylesheet">
    <style>body{font-family:'Inter Tight',sans-serif;background-color:#f4f4f5;display:flex;justify-content:center;align-items:center;min-height:100vh;margin:0;padding:2rem 0}.container{background-color:#fff;padding:2.5rem;border-radius:8px;box-shadow:0 4px 12px #0000001a;width:100%;max-width:420px}h1,h2{text-align:center;color:#18181b;margin-top:0}.form-group{margin-bottom:1.5rem}label{display:block;margin-bottom:.5rem;color:#52525b;font-weight:600}input,textarea{width:100%;padding:.75rem;border:1px solid #d4d4d8;border-radius:4px;box-sizing:border-box;font-family:'Inter Tight',sans-serif}button{width:100%;padding:.85rem;border:none;background-color:#18181b;color:#fff;border-radius:4px;cursor:pointer;font-size:1rem;font-weight:600}button.secondary{background-color:#e4e4e7;color:#18181b;margin-top:.75rem}button:disabled{background-color:#a1a1aa;cursor:not-allowed}button:hover:not(:disabled){background-color:#27272a}button.secondary:hover:not(:disabled){background-color:#d4d4d8}.message{text-align:center;margin-top:1rem;padding:.75rem;border-radius:4px;display:none;font-size:.9rem}.message.success{color:#15803d;background-color:#dcfce7}.message.error{color:#b91c1c;background-color:#fee2e2}.view-switcher{text-align:center;margin-top:1.5rem;color:#52525b}.view-switcher a{color:#18181b;font-weight:600;cursor:pointer;text-decoration:none}.view-switcher a:hover{text-decoration:underline}#account-view,#edit-view{text-align:center}#account-view img{width:100px;height:100px;border-radius:50%;object-fit:cover;margin-bottom:1rem;border:3px solid #e4e4e7}#account-view h2{margin-bottom:.5rem}#account-view p{color:#52525b;margin-top:0;margin-bottom:1.5rem}#account-view .details,#edit-view .form-group{text-align:left;word-break:break-all}#account-view .details p{background-color:#f4f4f5;padding:.75rem;border-radius:4px;margin-bottom:.75rem;color:#18181b}#account-view .details strong{color:#52525b;font-weight:600}</style>
</head>
<body>
    <div class="container">
        <!-- Login & Create Views are unchanged -->
        <div id="login-view"><h1>Login to Guahh</h1><form id="login-form"><div class="form-group"><label for="login-identifier">Email or Username</label><input type="text" id="login-identifier" name="loginIdentifier" required></div><div class="form-group"><label for="login-password">Password</label><input type="password" id="login-password" name="password" required></div><button type="submit">Login</button></form><p id="login-message" class="message"></p><div class="view-switcher">Don't have an account? <a onclick="showView('create-view')">Sign Up</a></div></div>
        <div id="create-view" style="display:none"><h1>Create Guahh Account</h1><form id="create-form"><div class="form-group"><label for="DisplayName">Display Name</label><input type="text" id="DisplayName" name="DisplayName" required></div><div class="form-group"><label for="Username">Username</label><input type="text" id="Username" name="Username" required></div><div class="form-group"><label for="Email">Email</label><input type="email" id="Email" name="Email" required></div><div class="form-group"><label for="Password">Password</label><input type="password" id="Password" name="Password" required></div><div class="form-group"><label for="ProfilePictureURL">Profile Picture URL</label><input type="url" id="ProfilePictureURL" name="ProfilePictureURL"></div><div class="form-group"><label for="Description">Description</label><textarea id="Description" name="Description" rows="3"></textarea></div><button type="submit">Create Account</button></form><p id="create-message" class="message"></p><div class="view-switcher">Already have an account? <a onclick="showView('login-view')">Login</a></div></div>

        <!-- NEW: Account Details View -->
        <div id="account-view" style="display:none"><img id="acc-pfp" src="" alt="Profile Picture"><h2 id="acc-displayname"></h2><p id="acc-username"></p><div class="details"><p><strong>Balance:</strong> $<span id="acc-balance"></span></p><p><strong>Email:</strong> <span id="acc-email"></span></p><p><strong>Description:</strong> <span id="acc-desc"></span></p></div><button id="edit-account-btn">Edit Account</button><button class="secondary" onclick="logout()">Logout</button></div>
        
        <!-- NEW: Edit Account View -->
        <div id="edit-view" style="display:none"><h2>Edit Account</h2><form id="edit-form"><div class="form-group"><label for="edit-DisplayName">Display Name</label><input type="text" id="edit-DisplayName" name="DisplayName" required></div><div class="form-group"><label for="edit-ProfilePictureURL">Profile Picture URL</label><input type="url" id="edit-ProfilePictureURL" name="ProfilePictureURL"></div><div class="form-group"><label for="edit-Description">Description</label><textarea id="edit-Description" name="Description" rows="3"></textarea></div><button type="submit">Save Changes</button></form><p id="edit-message" class="message"></p><button class="secondary" onclick="showView('account-view')">Back to Account</button></div>
    </div>

    <script>
        const webAppUrl="https://script.google.com/macros/s/AKfycbxJFwty5ELkJhLDXsOr86fvLts6h7Vff9Bbs24674mhGxTWrHNhttMoXgjtC3U_MsYC6A/exec";
        const views={login:document.getElementById("login-view"),create:document.getElementById("create-view"),account:document.getElementById("account-view"),edit:document.getElementById("edit-view")};
        const createForm=document.getElementById("create-form"),loginForm=document.getElementById("login-form"),editForm=document.getElementById("edit-form");
        let currentUser=null;function showView(e){Object.values(views).forEach(e=>e.style.display="none"),views[e].style.display="block"}
        function showMessage(e,t,o){const n=document.getElementById(e);n.textContent=t,n.className=`message ${o?"success":"error"}`,n.style.display="block"}
        function populateAccountView(e){if(!e)return;currentUser=e;const t=parseFloat(e.Balance||0).toFixed(2);document.getElementById("acc-pfp").src=e.ProfilePictureURL||"https://via.placeholder.com/100",document.getElementById("acc-displayname").textContent=e.DisplayName,document.getElementById("acc-username").textContent=`@${e.Username}`,document.getElementById("acc-balance").textContent=t,document.getElementById("acc-email").textContent=e.Email,document.getElementById("acc-desc").textContent=e.Description||"N/A",showView("account")}
        document.getElementById("edit-account-btn").addEventListener("click",()=>{if(!currentUser)return;document.getElementById("edit-DisplayName").value=currentUser.DisplayName,document.getElementById("edit-ProfilePictureURL").value=currentUser.ProfilePictureURL,document.getElementById("edit-Description").value=currentUser.Description,showView("edit")});
        createForm.addEventListener("submit",e=>{e.preventDefault();const t=e.target.querySelector("button");t.disabled=!0,t.textContent="Creating...",fetch(webAppUrl,{method:"POST",body:new FormData(createForm)}).then(e=>e.json()).then(e=>{"success"===e.result?(showMessage("create-message","Account created! Please log in.",!0),createForm.reset()):showMessage("create-message","Error: "+e.error,!1)}).catch(e=>showMessage("create-message","Network Error: "+e.message,!1)).finally(()=>{t.disabled=!1,t.textContent="Create Account"})});
        loginForm.addEventListener("submit",e=>{e.preventDefault();const t=e.target.querySelector("button");t.disabled=!0,t.textContent="Logging in...";let o=new URL(webAppUrl);o.searchParams.append("action","login"),o.searchParams.append("loginIdentifier",e.target.loginIdentifier.value),o.searchParams.append("password",e.target.password.value),fetch(o).then(e=>e.json()).then(e=>{"success"===e.result?(localStorage.setItem("guahhUser",JSON.stringify(e.user)),populateAccountView(e.user)):showMessage("login-message",e.message||"Unknown error.",!1)}).catch(e=>showMessage("login-message","Network Error: "+e.message,!1)).finally(()=>{t.disabled=!1,t.textContent="Login"})});
        editForm.addEventListener("submit",e=>{e.preventDefault();if(!currentUser)return;const t=e.target.querySelector("button");t.disabled=!0,t.textContent="Saving...";const o=new FormData(editForm);o.append("action","update"),o.append("UserID",currentUser.UserID),fetch(webAppUrl,{method:"POST",body:o}).then(e=>e.json()).then(e=>{"success"===e.result?(localStorage.setItem("guahhUser",JSON.stringify(e.user)),populateAccountView(e.user)):showMessage("edit-message","Error: "+e.error,!1)}).catch(e=>showMessage("edit-message","Network Error: "+e.message,!1)).finally(()=>{t.disabled=!1,t.textContent="Save Changes"})});
        function logout(){localStorage.removeItem("guahhUser"),currentUser=null,loginForm.reset(),showView("login")}
        document.addEventListener("DOMContentLoaded",()=>{const e=JSON.parse(localStorage.getItem("guahhUser")||"null");e?populateAccountView(e):showView("login")});
    </script>
</body>
</html>
